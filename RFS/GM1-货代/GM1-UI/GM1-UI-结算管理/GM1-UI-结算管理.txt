*** Settings ***
Suite Setup       m4-登录    # Run keywords | 维护结算相关基础信息 | AND | m4-登录
Suite Teardown    close all browsers
Test Setup        回到首页
Resource          ../../../Resources/GM1/GM1-UI/GM1-UI-公共/GM1-UI-引用.txt

*** Test Cases ***
【必选】获取工作单号
    Set Suite Variable    ${发票抬头}    大香蕉公用
    ${workno-suit}    新增工作单
    Set Suite Variable    ${WORKNUMBER}    ${workno-suit}

123
    Set Suite Variable    ${发票抬头}    大香蕉公用
    Set Suite Variable    ${WORKNUMBER}    CYNT19090116

新增收入费用
    进入指定一级菜单    订单
    进入指定二级菜单(新icon)    订
    订单列表高级查询(双列)    各类编号    ${WORKNUMBER}    精确
    点击业务编号进入详情页    ${WORKNUMBER}
    等待加载层消失
    切换窗口    new
    点击费用
    Comment    ${新增前折合金额}    获取总计毛利折合CNY
    ${新增金额}    新增收入费用    ${往来单位}    ${发票抬头}
    #    ${新增后折合金额}    获取总计毛利折合CNY
    #    #验证
    #    ${合计}    Evaluate    ${新增后折合金额}-${新增金额}-${新增前折合金额}
    #    ${预期值}    Evaluate    float(0.0)
    #    应该要相等    ${合计}    ${预期值}
    关闭当前窗口

新增支出费用
    进入指定一级菜单    订单
    进入指定二级菜单(新icon)    订
    订单列表高级查询(双列)    各类编号    ${WORKNUMBER}    精确
    点击业务编号进入详情页    ${WORKNUMBER}
    等待加载层消失
    切换窗口    new
    点击费用
    Comment    ${新增前折合金额}    获取总计毛利折合CNY
    ${新增金额}    新增支出费用    ${往来单位}    ${发票抬头}
    #    ${新增后折合金额}    获取总计毛利折合CNY
    #    #验证
    #    ${合计}    Evaluate    round(${新增前折合金额}-${新增金额}-${新增后折合金额},2)
    #    ${预期值}    Evaluate    float(0.0)
    #    应该要相等    ${合计}    ${预期值}
    关闭当前窗口

删除收入费用
    进入指定一级菜单    订单
    进入指定二级菜单(新icon)    订
    订单列表高级查询(双列)    各类编号    ${WORKNUMBER}    精确
    点击业务编号进入详情页    ${WORKNUMBER}
    切换窗口    new
    点击费用
    ${新增金额}    新增收入费用    ${往来单位}    ${发票抬头}
    Comment    ${新增金额}    新增收入费用    ${往来单位}    ${发票抬头}
    Comment    ${删除前折合金额}    获取总计毛利折合CNY
    删除收入费用
    #    ${删除后折合金额}    获取总计毛利折合CNY
    #    #验证
    #    ${合计}    Evaluate    round(${删除前折合金额}-${新增金额}-${删除后折合金额},2)
    #    ${预期值}    Evaluate    float(0.0)
    #    应该要相等    ${合计}    ${预期值}
    关闭当前窗口

删除支出费用
    进入指定一级菜单    订单
    进入指定二级菜单(新icon)    订
    订单列表高级查询(双列)    各类编号    ${WORKNUMBER}    精确
    点击业务编号进入详情页    ${WORKNUMBER}
    切换窗口    new
    点击费用
    ${新增金额}    新增支出费用    ${往来单位}    ${发票抬头}
    Comment    ${新增金额}    新增支出费用    ${往来单位}    ${发票抬头}
    Comment    ${删除前折合金额}    获取总计毛利折合CNY
    删除支出费用
    #    ${删除后折合金额}    获取总计毛利折合CNY
    #    #验证
    #    ${合计}    Evaluate    round(${删除后折合金额}-${新增金额}-${删除前折合金额},2)
    #    ${预期值}    Evaluate    float(0.0)
    #    应该要相等    ${合计}    ${预期值}
    关闭当前窗口

新增结算单
    点击结算
    进入指定二级菜单(新icon)    费
    进入列表框架
    点击费用列表--按工作单
    点击新增结算单按钮
    离开框架
    切换窗口    new
    ${businessno}    新增结算单
    关闭当前窗口
    回到首页
    点击结算
    进入指定二级菜单(新icon)    费
    进入列表框架
    点击费用列表--按工作单
    费用列表--按工作单页面查询    ${businessno}
    ${result}    获取页面数据条数
    应该要相等（数字）    ${result}    1
    离开框架

复制结算单
    点击结算
    进入指定二级菜单(新icon)    费
    进入列表框架
    点击费用列表--按工作单
    点击新增结算单按钮
    离开框架
    切换窗口    new
    ${businessno1}    新增结算单
    关闭当前窗口
    回到首页
    点击结算
    进入指定二级菜单(新icon)    费
    进入列表框架
    点击费用列表--按工作单
    费用列表--按工作单页面查询    ${businessno1}
    勾选全部
    点击复制结算单按钮
    离开框架
    切换窗口    new
    点击结算单保存按钮
    Wait Until Element Is Not Visible    id=loading
    ${businessno2}    获取页面文本内容    xpath=//div[@id='businessno_id_div']//div[@class='ant-form-item-control ']//span
    关闭当前窗口
    回到首页
    点击结算
    进入指定二级菜单(新icon)    费
    进入列表框架
    点击费用列表--按工作单
    费用列表--按工作单页面查询    ${businessno2}
    ${result}    获取页面数据条数
    应该要相等（数字）    ${result}    1
    离开框架

删除结算单
    点击结算
    进入指定二级菜单(新icon)    费
    进入列表框架
    点击费用列表--按工作单
    点击新增结算单按钮
    离开框架
    切换窗口    new
    ${businessno}    新增结算单
    关闭当前窗口
    回到首页
    点击结算
    进入指定二级菜单(新icon)    费
    进入列表框架
    点击费用列表--按工作单
    费用列表--按工作单页面查询    ${businessno}
    勾选全部
    点击删除结算单按钮
    等待loading消失
    费用列表--按工作单页面查询    ${businessno}
    ${result}    获取页面列表条数    费用列表
    应该要相等（数字）    ${result}    0
    离开框架

新增对账单
    #维护费用
    进入指定一级菜单    订单
    进入指定二级菜单(新icon)    订
    订单列表高级查询(双列)    各类编号    ${WORKNUMBER}    精确
    点击业务编号进入详情页    ${WORKNUMBER}
    切换窗口    new
    点击费用
    新增收入费用    ${往来单位}    ${发票抬头}
    新增支出费用    ${往来单位}    ${发票抬头}
    关闭当前窗口
    #生成对账单
    回到首页
    进入指定一级菜单    结算
    进入指定二级菜单(新icon)    账
    进入列表框架
    新增对账单--按工作单页面查询    ${WORKNUMBER}
    勾选全部
    点击列表按钮    生成对账单
    离开框架
    ${checkaccountno}    生成对账单
    关闭当前窗口
    #检查对账单是否生成
    回到首页
    进入指定一级菜单    结算
    进入指定二级菜单(新icon)    账
    点击对账单管理
    进入列表框架
    对账单管理页面查询    ${checkaccountno}
    ${result}    获取页面数据条数
    应该要相等（数字）    ${result}    1
    离开框架

开票通知--按对账单
    #维护费用
    进入指定一级菜单    订单
    进入指定二级菜单(新icon)    订
    订单列表高级查询(双列)    各类编号    ${WORKNUMBER}    精确
    点击业务编号进入详情页    ${WORKNUMBER}
    切换窗口    new
    点击费用
    新增收入费用    ${往来单位}    ${发票抬头}
    新增支出费用    ${往来单位}    ${发票抬头}
    关闭当前窗口
    #生成对账单
    回到首页
    进入指定一级菜单    结算
    进入指定二级菜单(新icon)    账
    进入列表框架
    新增对账单--按工作单页面查询    ${WORKNUMBER}
    勾选全部
    点击列表按钮    生成对账单
    离开框架
    ${checkaccountno}    生成对账单
    关闭当前窗口
    #生成开票通知
    回到首页
    进入指定一级菜单    结算
    进入指定二级菜单(新icon)    账
    点击对账单管理
    进入列表框架
    对账单管理页面查询    ${checkaccountno}
    勾选全部
    点击列表按钮    开票通知
    离开框架
    ${preInvoiceno}    生成开票通知
    关闭当前窗口
    #检查开票通知是否生成
    回到首页
    进入指定一级菜单    结算
    进入指定二级菜单(新icon)    票
    进入列表框架
    应收待开票页面查询    ${preInvoiceno}
    ${result}    获取页面数据条数
    应该要相等（数字）    ${result}    1
    离开框架

开票通知--费用详情
    #维护费用
    进入指定一级菜单    订单
    进入指定二级菜单(新icon)    订
    订单列表高级查询(双列)    各类编号    ${WORKNUMBER}    精确
    点击业务编号进入详情页    ${WORKNUMBER}
    切换窗口    new
    点击费用
    ${新增金额}    新增收入费用    ${往来单位}    ${发票抬头}
    #生成开票通知
    费用详情点击开票通知
    ${preInvoiceno}    生成开票通知
    关闭当前窗口
    #检查开票通知是否生成
    回到首页
    进入指定一级菜单    结算
    进入指定二级菜单(新icon)    票
    进入列表框架
    应收待开票页面查询    ${preInvoiceno}
    ${result}    获取页面数据条数
    应该要相等（数字）    ${result}    1
    离开框架

应收登记发票
    #维护费用
    进入指定一级菜单    订单
    进入指定二级菜单(新icon)    订
    订单列表高级查询(双列)    各类编号    ${WORKNUMBER}    精确
    点击业务编号进入详情页    ${WORKNUMBER}
    切换窗口    new
    点击费用
    ${新增金额}    新增收入费用    ${往来单位}    ${发票抬头}
    #生成开票通知
    费用详情点击开票通知
    ${preInvoiceno}    生成开票通知
    关闭当前窗口
    #生成发票
    回到首页
    进入指定一级菜单    结算
    进入指定二级菜单(新icon)    票
    进入列表框架
    应收待开票页面查询    ${preInvoiceno}
    勾选全部
    点击列表按钮    自定义开票
    离开框架
    切换窗口    new
    勾选全部
    点击列表按钮    登记发票号
    ${应收invoice}    生成应收登记发票
    #验证发票
    切换窗口    new
    应收发票管理页面查询    ${应收invoice}
    ${实际值}    获取页面数据条数
    ${预期值}    Evaluate    str(1)
    应该要相等    ${实际值}    ${预期值}
    关闭当前窗口

收款核销--按工作单
    #维护收入费用
    进入指定一级菜单    订单
    进入指定二级菜单(新icon)    订
    订单列表高级查询(双列)    各类编号    ${WORKNUMBER}    精确
    点击业务编号进入详情页    ${WORKNUMBER}
    切换窗口    new
    点击费用
    新增收入费用    ${往来单位}    ${发票抬头}
    整票确认
    关闭当前窗口
    #生成收款单
    切换窗口    欢迎您使用本系统
    进入指定一级菜单    结算
    进入指定二级菜单(新icon)    收
    进入列表框架
    ${recbillno}    生成收款单    CNY    20000    公账    ${往来单位}    ${发票抬头}
    #添加费用并提交财务
    收款单添加费用--按工作单    ${WORKNUMBER}
    #收款核销
    收款单管理页面查询    收款单号    ${recbillno}
    点击    xpath=//a[text()='${recbillno}']    #点击收款单超链接
    离开框架
    收款单详情核销
    关闭当前窗口
    #验证核销成功
    切换窗口    欢迎您使用本系统
    点击核销记录(收款)
    进入列表框架
    核销记录(收款)页面查询    核销编号    ${recbillno}
    ${实际值}    获取页面数据条数
    ${预期值}    Evaluate    str(1)
    应该要相等    ${实际值}    ${预期值}
    离开框架

收款核销--按发票
    #维护费用
    进入指定一级菜单    订单
    进入指定二级菜单(新icon)    订
    订单列表高级查询(双列)    各类编号    ${WORKNUMBER}    精确
    点击业务编号进入详情页    ${WORKNUMBER}
    切换窗口    new
    点击费用
    ${新增金额}    新增收入费用    ${往来单位}    ${发票抬头}
    #生成开票通知
    费用详情点击开票通知
    ${preInvoiceno}    生成开票通知
    关闭当前窗口
    #生成发票
    回到首页
    进入指定一级菜单    结算
    进入指定二级菜单(新icon)    票
    进入列表框架
    应收待开票页面查询    ${preInvoiceno}
    勾选全部
    点击列表按钮    自定义开票
    离开框架
    切换窗口    new
    勾选全部
    点击列表按钮    登记发票号
    ${应收invoice}    生成应收登记发票
    关闭当前窗口
    #生成收款单
    回到首页
    进入指定一级菜单    结算
    进入指定二级菜单(新icon)    收
    进入列表框架
    ${recbillno}    生成收款单    CNY    20000    公账    ${往来单位}    ${发票抬头}
    #添加费用并提交财务
    收款单添加费用--按发票    ${应收invoice}
    #收款核销
    收款单管理页面查询    收款单号    ${recbillno}
    点击    xpath=//a[text()='${recbillno}']    #点击收款单超链接
    离开框架
    收款单详情核销
    关闭当前窗口
    #验证核销成功
    切换窗口    欢迎您使用本系统
    点击核销记录(收款)
    进入列表框架
    核销记录(收款)页面查询    核销编号    ${recbillno}
    ${实际值}    获取页面数据条数
    ${预期值}    Evaluate    str(1)
    应该要相等    ${实际值}    ${预期值}
    离开框架

收款核销--按对账单
    #维护收入费用
    进入指定一级菜单    订单
    进入指定二级菜单(新icon)    订
    订单列表高级查询(双列)    各类编号    ${WORKNUMBER}    精确
    点击业务编号进入详情页    ${WORKNUMBER}
    切换窗口    new
    点击费用
    新增收入费用    ${往来单位}    ${发票抬头}
    关闭当前窗口
    #生成对账单
    回到首页
    进入指定一级菜单    结算
    进入指定二级菜单(新icon)    账
    进入列表框架
    新增对账单--按工作单页面查询    ${WORKNUMBER}
    勾选全部
    点击列表按钮    生成对账单
    离开框架
    ${checkaccountno}    生成对账单
    关闭当前窗口
    #生成收款单
    回到首页
    进入指定一级菜单    结算
    进入指定二级菜单(新icon)    收
    进入列表框架
    ${recbillno}    生成收款单    CNY    20000    公账    ${往来单位}    ${发票抬头}
    #添加费用并提交财务
    收款单添加费用--按对账单    ${checkaccountno}
    #收款核销
    收款单管理页面查询    收款单号    ${recbillno}
    点击    xpath=//a[text()='${recbillno}']    #点击收款单超链接
    离开框架
    收款单详情核销
    关闭当前窗口
    #验证核销成功
    切换窗口    欢迎您使用本系统
    点击核销记录(收款)
    进入列表框架
    核销记录(收款)页面查询    核销编号    ${recbillno}
    ${实际值}    获取页面数据条数
    ${预期值}    Evaluate    str(1)
    应该要相等    ${实际值}    ${预期值}
    离开框架

应付登记发票
    #维护费用
    进入指定一级菜单    订单
    进入指定二级菜单(新icon)    订
    订单列表高级查询(双列)    各类编号    ${WORKNUMBER}    精确
    点击业务编号进入详情页    ${WORKNUMBER}
    切换窗口    new
    点击费用
    新增支出费用    ${往来单位}    ${发票抬头}
    关闭当前窗口
    #登记应付发票
    回到首页
    进入指定一级菜单    结算
    进入指定二级菜单(新icon)    票
    点击应付待登记
    进入列表框架
    登记发票--按工作单页面查询    ${WORKNUMBER}
    勾选全部
    点击列表按钮    自定义开票
    离开框架
    切换窗口    new
    勾选全部
    点击列表按钮    登记发票号
    ${time}    get time    epoch
    ${应付invoice}    生成应付登记发票    ${time}
    #验证发票
    关闭当前窗口
    切换窗口    欢迎您使用本系统
    进入指定一级菜单    结算
    进入指定二级菜单(新icon)    票
    点击应付发票管理
    进入列表框架
    应付发票管理页面查询    ${应付invoice}
    ${实际值}    获取页面数据条数
    ${预期值}    Evaluate    str(1)
    应该要相等    ${实际值}    ${预期值}
    离开框架

付款核销--按发票
    #维护费用
    进入指定一级菜单    订单
    进入指定二级菜单(新icon)    订
    订单列表高级查询(双列)    各类编号    ${WORKNUMBER}    精确
    点击业务编号进入详情页    ${WORKNUMBER}
    切换窗口    new
    点击费用
    新增支出费用    ${往来单位}    ${发票抬头}
    关闭当前窗口
    #登记应付发票
    回到首页
    进入指定一级菜单    结算
    进入指定二级菜单(新icon)    票
    点击应付待登记
    进入列表框架
    登记发票--按工作单页面查询    ${WORKNUMBER}
    勾选全部
    点击列表按钮    自定义开票
    离开框架
    切换窗口    new
    勾选全部
    点击列表按钮    登记发票号
    ${time}    get time    epoch
    ${应付invoice}    生成应付登记发票    ${time}
    关闭当前窗口
    #生成请款单
    回到首页
    进入指定一级菜单    结算
    进入指定二级菜单(新icon)    票
    点击应付发票管理
    进入列表框架
    应付发票管理页面查询    ${应付invoice}
    勾选全部
    点击列表按钮    请 款
    离开框架
    ${applyNo}    生成请款单    公账
    关闭当前窗口
    #填付款依据
    切换窗口    欢迎您使用本系统
    进入指定一级菜单    结算
    进入指定二级菜单(新icon)    付
    #生成待付款单
    点击请款单管理
    进入列表框架
    请款单管理--不可受理页面查询    ${applyNo}
    勾选全部
    点击列表按钮    受理&生成待付款单
    生成待付款单
    离开框架
    #生成付款单并核销
    点击付款单管理
    进入列表框架
    付款单管理--待付款未审核页面查询    ${applyNo}
    ${待付款单号}    获取页面文本内容    xpath=//a[contains(@href,'/fmsfinance-front/#/paymentDetail?id=')]
    勾选全部
    待付款单审核
    点击待付款待核销
    付款单管理--待付款待核销页面查询    ${待付款单号}
    点击    xpath=//a[contains(@href,'/fmsfinance-front/#/paymentDetail?id=')]    #点击超链接
    离开框架
    ${paybillno}    待付款单生成付款单并核销
    #验证核销成功
    切换窗口    欢迎您使用本系统
    点击核销记录(付款)
    进入列表框架
    核销记录(付款)页面查询    核销编号    ${paybillno}
    ${实际值}    获取页面数据条数
    ${预期值}    Evaluate    str(1)
    应该要相等    ${实际值}    ${预期值}
    离开框架

收款--快速核销--按费用
    #维护收入费用
    进入指定一级菜单    订单
    进入指定二级菜单(新icon)    订
    订单列表高级查询(双列)    各类编号    ${WORKNUMBER}    精确
    点击业务编号进入详情页    ${WORKNUMBER}
    切换窗口    new
    点击费用
    新增收入费用    ${往来单位}    ${发票抬头}
    整票确认
    关闭当前窗口
    #生成收款单
    切换窗口    欢迎您使用本系统
    进入指定一级菜单    结算
    进入指定二级菜单(新icon)    费
    进入列表框架
    费用列表--按费用页面高级查询    工作单号    ${WORKNUMBER}
    点击    xpath=//tbody[@class='ant-table-tbody']/tr[1]//input    #勾选列表第一条数据
    点击列表按钮    快速核销
    ${recbillno}    进入快速核销页面核销    recbillno
    离开框架
    进入指定二级菜单(新icon)    收
    点击核销记录(收款)
    进入列表框架
    核销记录(收款)页面查询    核销编号    ${recbillno}
    ${实际值}    获取页面数据条数
    ${预期值}    Evaluate    str(1)
    应该要相等    ${实际值}    ${预期值}
    离开框架

收款--快速核销--按发票
    #维护费用
    进入指定一级菜单    订单
    进入指定二级菜单(新icon)    订
    订单列表高级查询(双列)    各类编号    ${WORKNUMBER}    精确
    点击业务编号进入详情页    ${WORKNUMBER}
    切换窗口    new
    点击费用
    ${新增金额}    新增收入费用    ${往来单位}    ${发票抬头}
    #生成开票通知
    费用详情点击开票通知
    ${preInvoiceno}    生成开票通知
    关闭当前窗口
    #生成发票
    回到首页
    进入指定一级菜单    结算
    进入指定二级菜单(新icon)    票
    进入列表框架
    应收待开票页面查询    ${preInvoiceno}
    勾选全部
    点击列表按钮    自定义开票
    离开框架
    切换窗口    new
    勾选全部
    点击列表按钮    登记发票号
    ${应收invoice}    生成应收登记发票
    关闭当前窗口
    回到首页
    进入指定一级菜单    结算
    进入指定二级菜单(新icon)    票
    点击应收发票管理
    进入列表框架
    应收发票管理页面查询    ${应收invoice}
    勾选全部
    点击列表按钮    快速核销
    ${recbillno}    进入快速核销页面核销    recbillno
    离开框架
    进入指定二级菜单(新icon)    收
    点击核销记录(收款)
    进入列表框架
    核销记录(收款)页面查询    核销编号    ${recbillno}
    ${实际值}    获取页面数据条数
    ${预期值}    Evaluate    str(1)
    应该要相等    ${实际值}    ${预期值}
    离开框架

付款--快速核销--按发票
    #维护费用
    进入指定一级菜单    订单
    进入指定二级菜单(新icon)    订
    订单列表高级查询(双列)    各类编号    ${WORKNUMBER}    精确
    点击业务编号进入详情页    ${WORKNUMBER}
    切换窗口    new
    点击费用
    新增支出费用    ${往来单位}    ${发票抬头}
    关闭当前窗口
    #登记应付发票
    回到首页
    进入指定一级菜单    结算
    进入指定二级菜单(新icon)    票
    点击应付待登记
    进入列表框架
    登记发票--按工作单页面查询    ${WORKNUMBER}
    勾选全部
    点击列表按钮    自定义开票
    离开框架
    切换窗口    new
    勾选全部
    点击列表按钮    登记发票号
    ${time}    get time    epoch
    ${应付invoice}    生成应付登记发票    ${time}
    关闭当前窗口
    #生成请款单
    回到首页
    进入指定一级菜单    结算
    进入指定二级菜单(新icon)    票
    点击应付发票管理
    进入列表框架
    应付发票管理页面查询    ${应付invoice}
    勾选全部
    点击列表按钮    快速核销
    ${paybillno}    进入快速核销页面核销    paybillno
    离开框架
    进入指定二级菜单(新icon)    付
    点击核销记录(付款)
    进入列表框架
    核销记录(付款)页面查询    核销编号    ${paybillno}
    ${实际值}    获取页面数据条数
    ${预期值}    Evaluate    str(1)
    应该要相等    ${实际值}    ${预期值}
    离开框架

111
    进入指定一级菜单    结算
    进入指定二级菜单(新icon)    付
    点击付款单管理
    进入列表框架
    付款单管理--待付款未审核页面查询    111111
    等待    5
