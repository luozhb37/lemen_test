*** Settings ***
Suite Setup       登录    # Run keywords | 系统参数设置 | AND | 往来单位初始化 | \ AND | 自定义初始化
Suite Teardown    close all browsers
Test Setup        Reload Page    #回到首页
Library           Selenium2Library
Resource          ../RFS/Resources/基础关键字.txt
Resource          ../RFS/Resources/M3基础操作/M3--引用.txt

*** Test Cases ***
发票核销2
    [Setup]
    点击    xpath=//*[text()="系统设置"]
    点击    xpath=//*[text()="系统参数"]
    进入框架    id=content
    点击    id=sys_paras_iv_writeoff_start
    点击    xpath=//*[text()="发票核销"]
    点击    xpath=//*[text()="保存"]
    离开框架
    退出
    读取货代登录配置信息
    进入框架    id=loginPanel
    输入    id=username    ${M3_USERNAME}
    输入    id=password    ${M3_PASSWORD}
    点击    id=btn-submit
    新增海运出口业务台账
    点击业务管理
    点击业务台帐
    海运出口列表查询业务编号    ${BUSINESSNO-SUIT-SEAEXPORT}
    进入台帐详情    ${BUSINESSNO-SUIT-SEAEXPORT}
    从台帐详情进入费用页面
    新增收入费用    1000    1    RMB    1
    关闭所有弹出框
    点击业务管理
    #生成收款单
    点击结算管理
    点击对账
    点击新增对账单
    新增对账单列表查询    qy_fee_checkdate_type=1    qy_businessno=${BUSINESSNO-SUIT-SEAEXPORT}
    进入一个框架后-全选记录
    点击选择
    ${model_fi_debitcredits_debitcreditno}    ${model_fi_debitcredits_invoiceno}    对账并标记开票    ${BUSINESSNO-SUIT-SEAEXPORT}
    点击收款
    点击收款登记
    进入框架    id=content
    输入    id=qyin_businessno    ${BUSINESSNO-SUIT-SEAEXPORT}
    点击    xpath=//*[text()="查询"]
    点击    css=.vrws-row-portlet-sel-checkbox
    点击    xpath=//*[text()="生成收款单"]
    离开框架
    进入框架    css=.ws
    清空输入框    id=bill_bankname    9
    输入    id=bill_bankname    ceshi2
    ${Payment receipt number}    Get Element Attribute    id=bill_recbillno    value
    ${Cost}    Get Element Attribute    id=bill_sumapply    value
    点击    xpath=//*[text()="生成并核销"]
    离开框架
    进入框架    css=.ws
    点击    xpath=//*[text()="保存并关闭"]
    sleep    1
    点击    xpath=//*[text()="核销记录"]
    进入框架    id=content
    输入    id=qyvr_verificationno    ${Payment receipt number}
    点击    xpath=//*[text()="查询"]
    ${amount}    获取页面文本内容    xpath=//*[@class="vrws-row-value" and @elementname='qp_recverification_records:writeoffamount']
    离开框架
    ${page}    获取列表记录数
    应该包含    ${page}    共1条
    应该要相等    ${Cost}    ${amount}
    关闭浏览器

iframe
    修改为按费用核销并重新登录
    新增海运出口业务台账
    点击业务管理
    点击业务台帐
    海运出口列表查询业务编号    ${BUSINESSNO-SUIT-SEAEXPORT}
    进入台帐详情    ${BUSINESSNO-SUIT-SEAEXPORT}
    从台帐详情进入费用页面
    新增收入费用    1000    1    RMB    1
    关闭所有弹出框
    点击业务管理
    #生成收款单
    点击结算管理
    点击对账
    点击新增对账单
    新增对账单列表查询    qy_fee_checkdate_type=1    qy_businessno=${BUSINESSNO-SUIT-SEAEXPORT}
    进入一个框架后-全选记录
    点击选择
    ${model_fi_debitcredits_debitcreditno}    ${model_fi_debitcredits_invoiceno}    对账并标记开票    ${BUSINESSNO-SUIT-SEAEXPORT}
    按对账单核销
    关闭浏览器

123
    点击结算管理
    ${Payment receipt number}    按发票--核销
    log    ${Payment receipt number}
    反核销--核销记录    ${Payment receipt number}
